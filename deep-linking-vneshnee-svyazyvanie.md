---
description: >-
  Принцип работы deep link (диплинка) прост, сформированная ссылка отправляет
  пользователя сразу на нужный маршрут в боте, минуя часть сценария
---

# Deep Linking / Внешнее связывание

### Введение

### Создание диплинка

Первым шагом для настройки диплинков в новом боте является настройка **Каналов** бота. Настройка **Каналов** производится в разделе главного меню **Настройки бота** подраздел [**Каналы**](https://app.metabot24.com/bot-channel)**.**

Например, в рассматриваемом боте настроены два канала:

* Metabot Widget
* Telegram

![](.gitbook/assets/izobrazhenie%20%28449%29.png)

Далее для настройки перейдем в раздел **Ссылки**, который  служит для создания диплинка.

Нужно создать **Ссылку** с типом ссылки _Ссылка на бот-скрипт \(Deep Link\)_, для этого перейти в раздел главного меню **Настройки бота** подраздел [**Ссылки**](https://app.metabot24.com/link).

![](.gitbook/assets/izobrazhenie%20%28434%29.png)

По имени, указанном в поле **Имя**, на диплинк можно ссылаться в макроподстановках. Формат ссылок, как имя диплинка - dpl1:

* {{ ^\#dpl1 }} - макроссылка, поддерживается в Маршрутах

Текст из поля **Текст/приглашение** будет добавлен к сообщению пользователя в мессенджере при его переходе по диплинку. Используется только для мессенджера - WhatsApp.  
Поле **URL** остаётся не заполненным.

Нажать кнопку _**Создать**_.

![](.gitbook/assets/izobrazhenie%20%28441%29.png)

### Настройка маршрутов

Для привязки диплинка к определённому скрипту бота следует создать маршрут со следующими настройками. Настроить маршруты можно в разделе главного меню **Настройки бота** подраздел [**Маршруты**](https://app.metabot24.com/route): 

* Опция _**Обработка Deep Link**_ - установить активность;
* _**Название**_ - текстовое наименование маршрута;
* _**Скрипт**_ - выбрать скрипт, который должен запускаться в данном маршруте;
* _**Регулярное выражение**_ - значение макроссылки {{ ^\#имя\_диплинка }}, например, 
  * {{ ^\#dpl1 }} - было определено при создании ссылки диплинка. 

Нажать кнопку _**Создать**_.

![](.gitbook/assets/izobrazhenie%20%28445%29.png)

Рекомендуется маршрут с диплинком разместить первым в списке всех маршрутов. Для этого можно воспользоваться кнопкой _**Перетащите для изменения порядка**_, расположенной в блоке **Операции**.

![](.gitbook/assets/izobrazhenie%20%28435%29.png)

### Использование диплинков

#### Внешние мессенджеры

После создания ссылки автоматически создаётся уникальный хеш диплинка и происходит генерация URL для каждого мессенджера.

![](.gitbook/assets/izobrazhenie%20%28440%29.png)

Перечень мессенджеров определяется из того, к каким Каналам подключен данный бот. Вместо **{текста в фигурных скобках}** в URL диплинка следует указать соответствующий ID бота в мессенджере.

**Пример для Telegram:**

![](.gitbook/assets/izobrazhenie%20%28448%29.png)

В ссылке для Telegram бота - https://app.metabot24.com/deeplink/telegram/**{имя-бота-telegram}**/ZfxWPpKhehQCrVuE

{имя-бота-telegram}  - заменить на **deeplink\_test\_bot**

![](.gitbook/assets/izobrazhenie%20%28436%29.png)

После подстановки ссылку с данным URL можно размещать в интернете. При необходимости к ней можно добавить параметры, как это стандартно делается для http-ссылок.

![](.gitbook/assets/izobrazhenie%20%28442%29.png)

При переходе по такой ссылке происходит редирект на API соответствующего мессенджера, в нашем примере на Telegram.

![](.gitbook/assets/izobrazhenie%20%28450%29.png)

Далее при нажатии _Send Message_ тоже автоматически в мессенджер. 

После того, как пользователь отреагирует в мессенджере. В примере с Telegram, нажмёт кнопку ЗАПУСТИТЬ, все параметры, которые были указаны в диплинке будут сохранены в переменных соответствующего лида в разделе Лиды на платформе. Бот стартует со скрипта указанного в маршруте для диплинка.

![](.gitbook/assets/izobrazhenie%20%28438%29.png)

**Пример для WhatsApp:**

В ссылке для Telegram бота - https://app.metabot24.com/deeplink/whatsapp/**{телефон-whatsapp}**/f2cdWYPOADnluTTT

{телефон-whatsapp} - заменить на номер телефона в формате 79ххххххххх

![](.gitbook/assets/izobrazhenie%20%28458%29.png)

После подстановки ссылку с данным URL можно размещать в интернете. При необходимости к ней можно добавить параметры, как это стандартно делается для http-ссылок.

![](.gitbook/assets/izobrazhenie%20%28457%29.png)

При переходе по такой ссылке происходит редирект на API соответствующего мессенджера, в нашем примере на WhatsApp.

![](.gitbook/assets/izobrazhenie%20%28456%29.png)

Далее при нажатии _Перейти в чат_ тоже автоматически в мессенджер. 

После того, как пользователь отреагирует в мессенджере. В примере с WhatsApp, нажмёт кнопку Отправки сообщения, произвойдет старт бота со скрипта указанного в маршруте для диплинка.

![](.gitbook/assets/izobrazhenie%20%28455%29.png)

#### Metabot Widget

Ключевым моментом здесь является задание атрибута _data-deeplink_. 

Шаблон ссылки-диплинка выводится в разделе **Ссылки**. При условии, что у бота подключен канал **Metabot Widget**.

![](.gitbook/assets/izobrazhenie%20%28452%29.png)

В настройках канала **Metabot Widget** в поле _**Всплывающий HTML**_ можно задать HTML-код.

В значении атрибута следует указать хеш, который был автоматически сгенерирован при создании диплинка.

![](.gitbook/assets/izobrazhenie%20%28454%29.png)

Описанный блок будет всплывать при наведении мышки на кнопку виджета.

![](.gitbook/assets/izobrazhenie%20%28443%29.png)

Для передачи дополнительных параметров с последующим сохранением их в параметрах Лида используются атрибуты _**href**_ и _**data-deeplink**_ тега гиперссылки.

Например, после перехода по следующей гиперссылкеуказанной в настройках виджета:

```text
 <a href="?utm-foo=bar" data-deeplink="ZfxWPpKhehQCrVuE" data-boom="bazz">
```

![](.gitbook/assets/izobrazhenie%20%28451%29.png)

В разделе **Лиды** на платформе, по соответствующему лиду, будут переданы и сохранены в параметрах лида следующие параметры:

* boom = bazz
* utm-foo = bar 

![](.gitbook/assets/izobrazhenie%20%28437%29.png)

