---
description: >-
  При использовании Dialogflow с контекстами, возникла необходимость в создании
  ботов с использованием нескольких агентов Dialogflow, для этого есть
  возможность настраивать несколько интеграций.
---

# Подключение нескольких интеграций

### Введение

Одновременное использование нескольких предварительно обученных нейронных сетей будет полезно для тех кому необходимо: 

1. иметь в одном боте несколько баз знаний по разным продуктам, сервисам или проблематикам;
2. иметь в одном внешнем боте несколько различных ботов с поддержкой естественного языка \(NLP\);
3. иметь поддержку нескольких языков.

Для использования этой возможности вам необходимо создать две или более нейронных сетей, настроить интеграции и затем в нужный момент переключаться между ними с помощью команд JavaScript в сценариях вашего бота.

### Настройка нескольких интеграций

Подключение нескольких интеграций Dialogflow производится в разделе главного меню **Настройки** **бота** в подразделе [**Интеграции**](https://app.metabot24.com/bot-integration).

В сервисе Dialogflow должно быть создано несколько Агентов, минимум 2 и настроены Учетные данные в разделе **API & Services** в подразделе **Credentials**, подробнее см. [Интеграция с Dialogflow](https://metabot.gitbook.io/documentation/dialogflow/integraciya-s-dialogflow).

Далее необходимо создать интеграции с указанием следующих параметров:

* Опция **Включена** - активность опции определяет активность интеграции;
* Интеграционная система - **Dialogflow \(nlp\)**;
* **Название** - название интеграции, уникальность контролируется в пределах бота;
* **Код** - дополнительный идентификатор. Используется для поиска интеграции, например, в JavaScript функциях;
* **Авторизационный ключ** \(json\) - закрытый ключ, который предоставляет сервис Dialogflow.

![](../.gitbook/assets/izobrazhenie%20%28457%29.png)

В списке **Интеграции с ботом**, интеграция по умолчанию отмечена серым цветом под ID интеграции. Надпись _NLP интеграция по умолчанию_ обновляется только после обновления страницы, поэтому после смены сортировки интеграций необходимо обновить страницу.

![](../.gitbook/assets/izobrazhenie%20%28464%29.png)

Изменить интеграцию по умолчанию можно переместив ее в начало списка, воспользовавшись функциональной кнопкой _**Перетащите для изменения порядка**_ в блоке **Операции**.

![](../.gitbook/assets/izobrazhenie%20%28463%29.png)

На платформе имеются методы JavaScript для проверки текущей и активности интеграции:

```text
bot.getIntegrationIdByCode - Текущий ID NLP интеграции, полученный по коду
bot.getEnabledIntegrationIdByCode - Текущий ID активной NLP интеграции, полученный по коду

bot.isEnabledIntegrationById - Включена NLP интеграция - проверка по ID
bot.isEnabledIntegrationByCode - Включена NLP интеграция - проверка по коду
```

На платформе имеются методы JavaScript для Лида:

```text
lead.setActiveNlpIntegrationById(): int|null - Устанавливается интеграция по ID
lead.setActiveNlpIntegrationByCode(): string - Устанавливается интеграция по коду

lead.hasActiveNlpIntegration - Установлена NLP интеграция

lead.getActiveNlpIntegrationId(): int|null - Текущий ID NLP интеграции
lead.getActiveNlpIntegrationCode(): string - Текущий код NLP интеграции

lead.getActiveOrFirstNlpIntegrationId(): int|null - Текущий ID NLP интеграции + по умолчанию, если не установлена
lead.getActiveOrFirstNlpIntegrationCode(): string - Текущий код NLP интеграции + по умолчанию, если не установлена
```



