---
description: База знаний, по которой бот понимает, что необходимо ответить пользователю
---

# Обучение бота

Для полноценной работы чат-бота с распознаванием намерений пользователя, необходимо создать и настроить базу знаний, по запросам к которой бот будет давать правильные ответы и выстраивать логику взаимодействия с пользователем.

Для этого вам понадобится сервис Dialogflow. На нем необходимо авторизоваться с помощью аккаунта Google.

{% hint style="info" %}
Как выполнять регистрацию и  интеграцию с соответствующим намерением из базы знаний в DF рекомендуем  ознакомиться в разделах [Регистрация с Dialogflow](https://metabot.gitbook.io/documentation/dialogflow/registraciya-v-dialogflow) и [Интеграция с Dialogflow](https://metabot.gitbook.io/documentation/dialogflow/integraciya-s-dialogflow).
{% endhint %}

После авторизации на сервисе Dialogflow и создании нового _Проекта / Агента_ дальнейшая работа по обучению бота будет производиться в разделе **Intents.**

![](<../.gitbook/assets/izobrazhenie (28).png>)



Создаем **Намерения**, с помощью которых бот сможет распознавать текстовые запросы пользователя и подбирать правильные ответы из базы знаний. По кнопке **Create Intent** или нажав на **+** около Intents,  создаем новое намерение**.**

![](<../.gitbook/assets/izobrazhenie (233).png>)

Например, создадим намерение **Приветствие** для стартового скрипта бота.

* В поле _Intent name_ указать заголовок намерения. например, "Приветствие".
* В разделе _ADD TRAINING PHRASES_ описываем перечень возможных вариантов обращения пользователя к чат-боту или синонимы ключевых слов.

{% hint style="info" %}
Если заголовок намерения состоит более чем из одного слова, то слова в заголовке должны быть соединены знаком нижнего подчеркивания "\_".
{% endhint %}

{% hint style="info" %}
Заголовок намерения необходимо указывать такой же, как и параметр _NLP Намерение_ в свойствах создаваемых скриптов, при этом регистр первых и последующих букв не важен.
{% endhint %}

![](<../.gitbook/assets/izobrazhenie (136).png>)

{% hint style="info" %}
Галочку на _NLP Action_ следует установить, если вы хотите, чтобы в данном скрипте была возможность распознавания других намерений, если же ваш скрипт является переходящим или не предполагает свободного ввода текста, то этот пункт можно не заполнять.
{% endhint %}

![Список возможных вариантов обращения пользователя](<../.gitbook/assets/izobrazhenie (278).png>)

{% hint style="warning" %}
При обучении бота, чем больше вы введете однородных по смыслу запросов и синонимов ключевых слов, тем более качественно ваш бот будет обучен.
{% endhint %}

Рекомендуем включить проверку на пересечение обучаемых фраз в различных **Намерениях**. Для этого в настройках _Проекта / Агента_ установите активность параметра проверки.

![](<../.gitbook/assets/izobrazhenie (197).png>)

Отслеживать проверку на пересечение необходимо в разделе _**Validation.**_

![](<../.gitbook/assets/izobrazhenie (26).png>)

При обучении бота необходимо избегать лишних слов и фраз, таких как "пожалуйста", "будьте добры" и так далее.

{% hint style="warning" %}
Так же при обучении бота намерению важно стараться не допускать фраз, которые могут повторяться в соседних намерениях, иначе бот из базы знаний может выбрать некорректный ответ.
{% endhint %}

![](<../.gitbook/assets/izobrazhenie (15).png>)

Знаки вопроса и прочие знаки препинания в конце предложения здесь прописывать не нужно. Применение вариантов с перестановкой слов приветствуется.&#x20;

На момент создания и описания намерения, а также и в дальнейшей работе доступна возможность редактирования намерения.

После ввода всех вариантов возможных обращение необходимо сохранить намерение, нажав на кнопку _Save._

![](<../.gitbook/assets/izobrazhenie (173).png>)

В процессе обучения бота нужно проверять правильность вводимых значений. Для этого, в поле _Try it now_ необходимо указать один из введенных вариантов обращения и система должна предоставить ссылку на нужное намерение. Например, при варианте вопроса "До скольки вы открыты" выдается намерение "Часы\_работы".

![](<../.gitbook/assets/izobrazhenie (81).png>)

Для того, чтобы бот отвечал на обращение пользователя не описанные в намерениях, необходимо создать скрипт **Живой разговор:**

* Укажите название скрипта. Например: "Живой разговор";
* Установить опцию _Включить NLP_;
* Установить интеграцию с намерением в поле _NLP намерение_ - установить значение _" **.\*** "_;
* Установить опцию _Использовать определение NLP Action_;
*   Установить интеграцию с функцией SmallTalk  в поле _NLP Action_

    &#x20;\- установить значение _" **.\*** "_;
* Остальные параметры без изменения.

![](<../.gitbook/assets/izobrazhenie (206).png>)

{% hint style="info" %}
Для того, чтобы вывести Small Talk ответ бота по распознанному NLP Action, то в скрипт нужно добавить команду [Отправить текст](https://metabot.gitbook.io/documentation/komandy/otpravit-tekst) и в поле _Текст_  указать&#x20;

{{ $nlpLastReponseText }}

Таким образом бот пришлет пользователю сообщение с ответом, полученным от DialogFlow Small Talk.
{% endhint %}

![](<../.gitbook/assets/izobrazhenie (8).png>)

В блоке **Меню** необходимо добавить пункт меню _**Повторяем**_, применяя следующие параметры:

* Нажмите на кнопку _**Добавить пункт меню**_;
* В поле _Код_ укажите букву "а" и в фигурных скобках значение 300, например, а{300}. Это регулярное выражение обезопасит чат-бот от случайно введенного не заложенного в сценарии варианта, который может привести к остановке бота.

{% hint style="info" %}
а{300} - это означает, что пользователь должен ввести символ "а" триста раз, чтобы попасть в этот пункт меню.
{% endhint %}

Однако, поскольку мы включили опцию _Включить NLP_ у скрипта, то ввод от пользователя в первую очередь будет отправлен в DF для распознавания намерения и только в случае, если намерение не будет найдено, ввод от пользователя будет использован для поиска пункта меню с соответствующим кодом.

{% hint style="warning" %}
Так сейчас работает интеграция с NLP-машиной на платформе Metabot. Если в скрипте включена опция NLP, то при достижении меню ввод от пользователя вначале проверяется в базе знаний NLP и только потом по меню.
{% endhint %}

* Установить опцию _Скрыть код;_
* В поле _Подпись пункта меню_ укажите, например, фразу  "Повторяем";
* Установите опцию _Скрыть весь пункт меню_

{% hint style="info" %}
Именно для того, чтобы логика распознавания намерения вначале проверялась в базе знаний NLP, мы установили у пункта меню опцию _Скрыть весь пункт меню_. Таким образом меню существует в логике, но не видно на экране. "Заглушка" в виде a{300} означает, что работает только NLP распознавание по базе и пользователь никогда не попадет в пункт меню.
{% endhint %}

В **Dialogflow** нужно включить функцию **Живой разговор**, где в свою очередь его тоже можно обучить. Для этого нужно перейти в раздел **Small talk**, активировав параметр _Enable_.

![](<../.gitbook/assets/izobrazhenie (279).png>)

{% hint style="success" %}
Поздравляем Вас с успешным обучением бота распознавать свободное общение бота с пользователями в сервисе Dialogflow!
{% endhint %}
