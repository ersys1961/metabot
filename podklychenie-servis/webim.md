---
description: Интеграция сервиса Webim с платформой Metabot24
---

# Webim

Интеграции сервиса [**Webim**](https://webim.ru/) с [**Metabot24**](https://app.metabot24.com) позволяет подключить бота в диалоги с клиентами в любых каналах связи. При этом, все новые диалоги вначале будут отправляться боту. По сценарию бот может переключить диалог на оператора.

История диалогов с ботами автоматически сохраняется в архиве.

### Подключение интеграции

Создайте новый аккаунт **Webim** или войдите в существующий.

![](../.gitbook/assets/izobrazhenie%20%28378%29.png)

Произведите настройки аккаунта Webim для дальнейшей интеграции с платформой Metabot24, перейдя в раздел **Отделы**:

![](../.gitbook/assets/izobrazhenie%20%28119%29.png)

Для реализации работы с переводом на Оператора необходимо создать в аккаунте Webim, как минимум 2 отдела: 

* Один отдел с сотрудником без Бота;
* Второй отдел с ботом. Для того, чтобы по умолчанию диалог стартовал с ботом, надо ему выставить более высокий приоритет в поле _Порядок сортировки_.

![](../.gitbook/assets/izobrazhenie%20%28376%29.png)

Например, можно произвести минимальные настройки Отделов в такой форме:

![](../.gitbook/assets/izobrazhenie%20%28267%29.png)

Далее перейдите в раздел **Сотрудники**:

![](../.gitbook/assets/izobrazhenie%20%28132%29.png)

Для регистрации нового сотрудника нажмите кнопку _Зарегистрировать нового сотрудника_:

![](../.gitbook/assets/izobrazhenie%20%28324%29.png)

Для работы необходимо зарегистрировать как минимум 3-х сотрудников:

* Первый сотрудник, он же может быть и администратором аккаунта Webim, должен быть включен в отдел **Операторы**;
* Второй сотрудник, через которого будет работать бот, должен быть включен в отдел **Бот**, с наивысшим приоритетом в поле _Порядок сортировки;_
* Третий сотрудник, это будет Оператор, на которого будет переводиться диалог, должен быть включен в отдел **Операторы**.

![](../.gitbook/assets/izobrazhenie%20%2851%29.png)

Далее перейдите в раздел **Боты**:

![](../.gitbook/assets/izobrazhenie%20%28131%29.png)

Нажмите кнопку _Создать нового бота_ и установите первоначальные настройки:

![](../.gitbook/assets/izobrazhenie%20%28285%29.png)

В диалоговом окне указать следующие параметры:

* _Оператор для бота_ - указать имя сотрудника, под которым будет работать Бот;
* _Тип бота_ - Умный бот;
* _Порядок сортировки_ - по умолчанию 100;
* _Версия_ - указать параметр 2;
* _Ссылка на внешний API_ - указать любое значение, например, https://ya.ru, в дальнейшем будет редактироваться;
* _Токен авторизации_ - будет заполнен автоматически после сохранения настроек.

Сохранить настройки.

![](../.gitbook/assets/izobrazhenie%20%2847%29.png)

Скопируйте в буфер обмена токен, который сгенерируется при создании бота в Webim:

![](../.gitbook/assets/izobrazhenie%20%2845%29.png)

На платформе [**Metabot24**](https://app.metabot24.com) в настройках своего бота необходимо выполнить следующие действия:

* Перейти в раздел [**Настройки бота**](https://app.metabot24.com/bot-channel#) подраздел [**Каналы**](https://metarex.gitbook.io/metabot24/panel-upravleniya-botom/kanaly)**;**
* Нажать кнопку **Новая привязка** и выбрать канал **Webim.**

В диалоговом окне указать следующие параметры: 

* _Имя хоста_ - это адрес, который отображается при входе в личный кабинет Webim в адресной строке браузера. Вводится без протокола и закрывающей косой, например, metabot3.webim.ru.;
* _Логин_ - логин администратора учётной записи Webim;
* _Пароль_ - пароль администратора учётной записи Webim;
* _Код отдела для перевода на оператора_ - буквенный идентификатор отдела, на который будет переведен диалог при вызове команды _Перевести на оператора._ Код отдела отображается в Webim на странице редактирования отдела, например, operatory:
* Установить активность параметра _Использовать inline-кнопки_;
* _Токен_ - скопировать из буфера обмена токен сгенерированный при создании бота в Webim.

Сохранить настройки.

![](../.gitbook/assets/izobrazhenie%20%2867%29.png)

Далее нажмите пункт **Вебхук** и скопируйте сгенерированный вебхук. При копировании обратите внимание, чтобы не было в начале и в конце строки знаков «пробел».

![](../.gitbook/assets/izobrazhenie%20%2832%29.png)

Перейдите в личный кабинет Webim в раздел **Боты** и нажмите редактирование бота:

![](../.gitbook/assets/izobrazhenie%20%28236%29.png)

В поле _Ссылка на внешний API_ вставьте скорированный вебхук с платформы Metabot24 и сохранить настройку:

![](../.gitbook/assets/izobrazhenie%20%28242%29.png)

### Настройка каналов общения

После подключения интеграции с Metabot24 необходимо произвести настройку каналов общения в Webim. Для этого перейдите в раздел **Общие настройки**:

![](../.gitbook/assets/izobrazhenie%20%28384%29.png)

Перейдите в подраздел **Каналы общения** и произведите настройки каналов, согласно документации и рекомендациям Webim, например, _Telegram_:

![](../.gitbook/assets/izobrazhenie%20%28291%29.png)

Необходимо указать название бота и скопировать токен из **@BotFather** и сохранить настройки. Бот подключен.

![](../.gitbook/assets/izobrazhenie%20%28284%29.png)

Для получения дополнительный сведений о начале чата, назначении диалога на оператора, закрытии чата - необходимо в разделе **Общие настройки** в подразделе **Интеграции** в блоке _**Обработчики событий**_ заполнить необходимые поля. Поля формы заполняются адресом для вебхуков, указанным в настройках канала Webim на платформе Metabot24 со следующими дополнениями:

* _Начало чата_ - к адресу на конце надо дописать "?event=chat\_started" без кавычек; 
* _Подключение оператора_ - к адресу на конце надо дописать "?event=chat\_assigned" без кавычек;
* _Завершение чата_ - к адресу на конце надо дописать "?event=chat\_closed" без кавычек.

Сохранить настройку.

![](../.gitbook/assets/izobrazhenie%20%28332%29.png)

На этом всё. Бот подключен и готов к работе. Мы рекомендуем вам провести несколько тестовых диалогов, чтобы убедиться в правильности настройки сценариев. Увидеть активность пользователей при взаимодействии с ботом вы можете в разделе [**Лиды**](https://app.metabot24.com/lead) в личном кабинете Metabot24.

![](../.gitbook/assets/izobrazhenie%20%28143%29.png)

### Дополнительные возможности

1. Если чат переведён на Оператора, для того чтобы вернуть его обратно на Бота, нужно в панели Webim начать набирать ответный текст. При этом появляется функциональная кнопка _Перенаправить_, нажав на которую нужно выбрать оператора, на которого настроен Бот. 

![](../.gitbook/assets/izobrazhenie%20%2834%29.png)

2. Реализована поддержка следующих типов сообщений с платформы Metabot24:

* текстовое сообщение;
* кнопочное меню;
* вложения различных типов.

3. Если чат переведен на Оператора лидом или ботом через скрипт на платформе, то диалог должен закрыть Оператор по кнопке _Закрыть_ или он закроется автоматически по таймеру - _Тайм-аут автозакрытия чата с момента последней активности._ Таймеры настраиваются в разделе **Общие настройки**, подраздел **Тайм-ауты и сообщения:**

![](../.gitbook/assets/izobrazhenie%20%2883%29.png)

После выполнения тайм-аута окончательного закрытия чата, если по Лиду установлен параметр _Чат передан оператору_, то данный признак сбрасывается и выполняется скрипт с типом _**Возврат**_.

### Каналы связи Webim

На текущий момент Webim обеспечивает следующий список каналов связи для возможного подключения:

![](../.gitbook/assets/izobrazhenie%20%28302%29.png)

### Размещение чата на сайте

Для того, чтобы получить код чата для размещения на сайт, необходимо перейти в раздел **Настройки - Кнопки и размещения**:

![](../.gitbook/assets/izobrazhenie%20%28122%29.png)

В блоке **Код для сайта** размещен HTML-код, который необходимо вставить в код веб-страниц Вашего сайта, лучше всего в шаблон.

Параметр _Обращение для отдела_ необходимо указать отдел,  который указан в настройках для запуска бота, например, отдел **БОТЫ**.

![](../.gitbook/assets/izobrazhenie%20%28470%29.png)

