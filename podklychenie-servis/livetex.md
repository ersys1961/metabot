---
description: Интеграция сервиса LiveTex с платформой Metabot24
---

# LiveTex

Интеграции сервиса [**LiveTex**](https://my.livetex.ru/) с [**Metabot24**](https://app.metabot24.com) позволяет использовать данный сервис как чат-центр, в котором будут отображаться все диалоги с клиентами в любых прямых каналах связи. При этом, все новые диалоги вначале будут отправляться боту. По сценарию бот может переключить диалог на оператора.

История диалогов с ботами автоматически сохраняется в архиве.

### Подключение интеграции

Создайте новый аккаунт **LiveTex** или войдите в существующий.

![](<../.gitbook/assets/izobrazhenie (402).png>)

Если аккаунт только создан, то необходимо _Активировать пробный_ период.

![](<../.gitbook/assets/izobrazhenie (212).png>)

В разделе **Главная** необходимо добавить новую точку контакта.

![](<../.gitbook/assets/izobrazhenie (157).png>)

Нажмите на кнопку _Добавить_.

![](<../.gitbook/assets/izobrazhenie (389).png>)

Новая точка контакта должна быть с типом _Messaging API_, наименование можно указать произвольное.

![](<../.gitbook/assets/izobrazhenie (326).png>)

Нажмите на кнопку _Ключ доступа_ и сгенерируйте ключ доступа.

![](<../.gitbook/assets/izobrazhenie (91).png>)

У созданной точки необходимо скопировать ключ доступа.&#x20;

![](<../.gitbook/assets/izobrazhenie (174).png>)

На платформе [**Metabot24**](https://app.metabot24.com) в настройках своего бота необходимо выполнить следующие действия:

* Перейти в раздел [**Настройки бота**](https://app.metabot24.com/bot-channel) подраздел [**Каналы**](https://metabot.gitbook.io/documentation/panel-upravleniya-botom/kanaly)**;**
* Нажать кнопку **Новая привязка** и выбрать канал **LiveTex (Chat Center)**.

![](<../.gitbook/assets/izobrazhenie (356).png>)

В диалоговом окне указать следующие параметры:&#x20;

* _Канал_ - по умолчанию подставляется наименование создаваемого канала;
* _Заголовок сообщений бота_ - произвольная фраза, которая будет отображаться в чат-центре над сообщениями от Бота, рекомендуем вставить эмодзи для визуальной наглядности;
* _Заголовок сообщений лида_ - произвольная фраза, которая будет отображаться в чат-центре над сообщениями от Лида, рекомендуем вставить эмодзи для визуальной наглядности;
* _Исключаемые каналы_ - установить активность чекбокса на тех каналах, которые не должны попадать в чат-центр LiveTex:
  * Umnico, Bitrix, Jivo, Webim - каналы, в которых реализованы чат-центры, рекомендуем на них установить активность чекбокса;
  * Telegram, Metabot Widget, Viber, Vk - прямые каналы, которые можно объединить в чат-центр LiveTex;
* _Токен_ - скопировать из буфера обмена ключ доступа сгенерированный при создании точки контакта в LiveTex.

Сохранить настройки.

![](<../.gitbook/assets/izobrazhenie (321).png>)

Далее нажмите пункт **Вебхук**, тем самым Metabot24 через API настроит канал на отправку оповещений.

![](<../.gitbook/assets/izobrazhenie (156).png>)

### Настройка чат-центра

Пользователь, зарегистрированный в сервисе **LiveTex**, также является первым оператором. Для работы с чат-центром необходимо скачать приложение в личном кабинете через меню пользователя.

![](<../.gitbook/assets/izobrazhenie (298).png>)

\
Произведите настройки аккаунта LiveTex для дальнейшей интеграции с платформой Metabot24, перейдя в раздел **Настройки**, подраздел **Сотрудники**, добавьте дополнительных операторов, нажав на кнопку _Добавить сотрудника_.&#x20;

![](<../.gitbook/assets/izobrazhenie (25).png>)

\
Далее в разделе **Настройки** подразделе **Маршрутизация** на правой секции **Сотрудники группы** добавить заведённого сотрудника в список, нажав кнопку _Добавить_. В левой секции по умолчанию только одна группа _**Группа для Messaging API**_.

![](<../.gitbook/assets/izobrazhenie (211).png>)

{% hint style="warning" %}
На текущий момент в Metabot24 при работе с LiveTex выбирается первая группа по порядку (не по имени или коду), то есть заложен функционал работы с одной группой.
{% endhint %}

После подключения канала все сообщения пользователя начинают отправляться в **LiveTex**. При этом, если по сценарию взаимодействие происходит с Ботом, то есть не выполнен перевод на Оператора, то Операторы не видят эти сообщения в **LiveTex**. История переписки появляется у Оператора только после переключения диалога с бота.

### Дополнительные возможности

1. Реализована поддержка следующих типов сообщений с платформы Metabot24:
   * текстовое сообщение;
   * передача изображений, видео;
   * "меню", выводится в виде текста;
   * вложения различных типов.

{% hint style="info" %}
Выбор пользователем пункта **Меню** отображается в истории сообщений в виде кода скрипта пункта Меню.
{% endhint %}

2\. При переводе диалога на Оператора пользователь получает сообщение _**Диалог переведён на оператора**_. Далее при прочтении первого сообщения Оператором пользователь получает сообщение _**Оператор <имя оператора> подключился к диалогу**_.&#x20;

3\. Поддерживается перевод чатов между Операторами. Если был произведён перевод чата на другого оператора, то после прочтения диалога опять выводится сообщение _**Оператор <имя оператора> подключился к диалогу**_.&#x20;

4\. При закрытии чата Оператором пользователь получает сообщение _**Оператор вернул диалог боту**_.

5\. На платформе Metabot24 поддерживается функциональная возможность передачи атрибутов Лида для LiveTex. Для этого имеется функция _**setLiveTexAttr**_.&#x20;

Все переданные атрибуты будут отображены в шапке диалога в LiveTex. Пример вызова:

```
attr = {
 'номер_заявки': 705,
 'имя_заявки': 'Test',
 };
 lead.setLiveTexAttr(attr);
```

Функция записывает данные параметры в атрибуты лида с ключом _**sys\_livetex\_attrs**_ с типом _**system**_. При переводе диалога на Оператора они считываются и передаются в LiveTex.

6\. Если Операторов нет онлайн, то можно использовать скрипт с типом **Нет доступных операторов**. При переводе на оператора выполняется проверка наличия хотя бы одного Оператора со статусом online. Если таких нет, то вызывается скрипт с вышеуказанным типом.

7\. Имеется возможность выполнить проверку доступности операторов и после этого определить, какой скрипт запустить с типом **Перевод на оператора (онлайн)** или **Перевод на оператора (оффлайн)**.

### Каналы связи LiveTex

На текущий момент LiveTex обеспечивает следующий список каналов связи для возможного подключения:

![](<../.gitbook/assets/izobrazhenie (183).png>)
