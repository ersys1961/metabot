---
description: Интеграция сервиса Jivo с платформой Metabot24
---

# Jivo

Интеграции сервиса [**Jivo**](https://www.jivo.ru) с [**Metabot24**](https://app.metabot24.com) позволяет подключить бота в диалоги с клиентами в любых каналах связи. При этом, все новые диалоги вначале будут отправляться боту. По сценарию бот может переключить диалог на оператора.

История диалогов с ботами автоматически сохраняется в архиве.

### Подключение интеграции

На платформе [**Metabot24**](https://app.metabot24.com) в настройках своего бота необходимо выполнить следующие действия:

* Перейти в раздел [**Настройки бота**](https://app.metabot24.com/bot-channel#) подраздел [**Каналы**](https://metarex.gitbook.io/metabot24/panel-upravleniya-botom/kanaly)**;**
* Нажать кнопку **Новая привязка** и выбрать канал **Jivo**;

![](../.gitbook/assets/izobrazhenie%20%28322%29.png)

* Установите активность параметра _Использовать inline-кнопки_;
* Остальные параметры пока можно оставить без изменений, по умолчанию, и сохранить настройку.

![](../.gitbook/assets/izobrazhenie%20%28330%29.png)

Далее нажмите пункт **Вебхук** и скопируйте сгенерированный вебхук. При копировании обратите внимание, чтобы не было вначале и в конце строки знаков «пробел».

![](../.gitbook/assets/izobrazhenie%20%28375%29.png)

После получения вебхука, вам необходимо будет зайти в [приложение Jivo](https://app.jivosite.com/settings/integrations) в раздел **Каналы** **связи**, добавить канал, например, Telegram.

![](../.gitbook/assets/izobrazhenie%20%28230%29.png)

Подключить канал и далее провести настройку раздела **Настройки интеграции для разработчиков.** Для этого необходимо включить опцию Включить Webhooks и  заполнить поле URL для Webhooks, скопировав вебхук, полученный в Metabot.

Аналогично сделать настройку для виджета и всех подключенных каналов.

![](../.gitbook/assets/izobrazhenie%20%28316%29.png)

Перейдите в раздел **Интеграции** и выберите Metabot для подключения:

![](../.gitbook/assets/izobrazhenie%20%2816%29.png)

Затем настройте внешний вид бота, который будут видеть посетители, загрузив логотип компании или специальную иконку бота, указав имя и должность:

![](../.gitbook/assets/izobrazhenie%20%2857%29.png)

Перейдите на платформу [Metabot24](https://app.metabot24.com), в настройках бота в разделе [**Каналы**](https://app.metabot24.com/bot-channel) скопируйте в буфер обмена токен, как показано на рисунке.

![](../.gitbook/assets/izobrazhenie%20%28116%29.png)

Далее укажите токен бота из личного кабинета Metabot24 и выберите, на каких каналах связи будет подключен бот. При копировании токена будьте внимательны, чтобы в начале и в конце строки не было знаков «пробел».

![](../.gitbook/assets/izobrazhenie%20%28296%29.png)

После нажатия кнопки _Сохранить_, интеграция будет подключена и данный бот отобразится в подключенных системах. Обратите внимание, что когда добавляются новые каналы и интегрируются с Metabot24, то необходимо не забывать включать в разделе **Опции** активность для новых каналов.

![](../.gitbook/assets/izobrazhenie%20%2882%29.png)

На этом всё. Бот подключен и готов к работе. Мы рекомендуем вам провести несколько тестовых диалогов, чтобы убедиться в правильности настройки сценариев. Увидеть активность пользователей при взаимодействии с ботом вы можете в разделе [**Лиды**](https://app.metabot24.com/lead) в личном кабинете Metabot24.

![](../.gitbook/assets/izobrazhenie%20%28234%29.png)

### Заполнение контактных данных по лиду

После общения Лида \(пользователя\) с ботом можно в дальнейшем просмотреть его контактные данные: мессенджер, с которого общались, имя, телефон, e-mail.

Для этого в сервисе [**Jivo**](https://app.jivosite.com) ****необходимо выполнить следующие действия:

* По тестовому диалогу с каждого канала взаимодействия надо принять диалог оператором 

![](../.gitbook/assets/izobrazhenie%20%28161%29.png)

* Далее завершить диалог Оператором или дождаться, когда это произойдет автоматически через некоторое время отсутствия активности: 

![](../.gitbook/assets/izobrazhenie%20%28363%29.png)

* При изменении Оператором контактных данных по Лиду, когда оператор добавляет номер телефона или e-mail в карточке клиента в Jivo:

![](../.gitbook/assets/izobrazhenie%20%2869%29.png)

* На платформе Metabot24 в истории сообщений хранится параметр widget\_id, который является уникальным для каждого канала. По тестовому Лиду перейдите в историю сообщений:

![](../.gitbook/assets/izobrazhenie%20%2898%29.png)

* Далее перейдите по ссылке в webhooks-log:

![](../.gitbook/assets/izobrazhenie%20%28288%29.png)

* В строках с параметрами в поле _Event Type_ = chat\_accepted/chat\_finished/chat\_updated необходимо открыть ссылку _**Show Formatted Payload**_

![](../.gitbook/assets/izobrazhenie%20%28262%29.png)

* Cкопировать код параметра widget\_id:

![](../.gitbook/assets/izobrazhenie%20%28301%29.png)

* Открыть на редактирование канал **Jivo** в настройках бота:

![](../.gitbook/assets/izobrazhenie%20%287%29.png)

* Вставить скопированный код в соответствующее поле мессенджера и сохранить настройки:

![](../.gitbook/assets/izobrazhenie%20%28317%29.png)

* После этого при получении последующих CRM-вебхуков из этого канала для лидов будет прописываться соответствующий мессенджер, а также и все контактные данные из карточки лида отредактированные в сервисе **Jivo**.

![](../.gitbook/assets/izobrazhenie%20%28129%29.png)

### Дополнительные возможности

1. Bot API сервиса **Jivo** не поддерживает вложения, поэтому изображения и прочие вложения отправляемые с платформы **Metabot24** клиенту приходят в виде текста **URL:**

* Telegram автоматически делает такую ссылку активной и даже подгружает изображение;
* Чат-виджет ссылку передает просто текстом и не кликабельной, поэтому ее можно только выделить и скопировать текст, далее вставить в адресную строку браузера. 

2. Если в настройках канала включить параметр _Использовать inline-кнопки_, то кнопки прорисовываются и становятся кликабельны.

3. При подключении Оператора в чат с Лидом сервис **Jivo** отправляет сообщение в мессенджер о присоединении Оператора к чату. При выходе Оператора из чата сервис **Jivo** не отправляет никаких сообщений и в боте также не отображается, что Оператор вышел из чата с Лидом.

4. После завершения чата Оператором или если это произошло автоматически через определённое время простоя, теряется возможность отправки ботом сообщений в этот чат. Возможность возобновляется после перезагрузки данного чата Оператором или Лидом.

5. Имеется возможность переключения на Оператора с помощью команд в боте, обратно переключение на бота может сделать только Оператор - **Выйти из чата**, но Лид должен заново начать диалог, написав сообщение, иначе бот не возобновит работу.

6. Если Операторов нет онлайн, то при отправке сообщения приходит вебхук соответствующего события и в боте можно использовать вызов скрипта с типом **Нет доступных операторов**.

7. При перенаправлении чата от одного Оператора другому Оператору, никаких событий от сервиса **Jivo** не поступает в **Metabot24** и этот момент не обрабатывается на платформе, в бота не отправляются уведомительные сообщения.

8. Рекомендуемые настройки канала, для отображения чата.

Можно настроить автоматические действия и поведение чат-бота при недоступности Операторов, для этого в настройках канала в разделе **Автоматические действия** отключить все пункты и добавить новый пункт _Показать чат-бот при самом первом посещении сайта_, делается это с помощью кнопки **Добавить действие**.

![](../.gitbook/assets/izobrazhenie%20%28418%29.png)

В новом пункте указать следующие рекомендованные настройки по условиям:

* Время на сайте
* Количество визитов
* Время от последнего активного приглашения

![](../.gitbook/assets/izobrazhenie%20%28422%29.png)

При таких настройках окно чата будет показываться пользователю при первом посещении через 20 сек.

В разделе **Форма контактов** необходимо отключить запрос формы контактов клиента.

![](../.gitbook/assets/izobrazhenie%20%28421%29.png)

В разделе **Кнопки в чате** можно настроить поведение чата при условии, что пользователь еще ничего не написал. Это рекомендуется настраивать, чтоб при повторном обращении в бота спустя время, пользователь мог нажать на кнопку и активировать бота или при первом посещении чата - окно чата не было пустым.

![](../.gitbook/assets/izobrazhenie%20%28419%29.png)

### Каналы связи Jivo

На текущий момент Jivo обеспечивает следующий список каналов связи для возможного подключения:

![](../.gitbook/assets/izobrazhenie%20%28214%29.png)

